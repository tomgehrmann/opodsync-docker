# opodsync-docker

Automated, hardened container image builds for [oPodSync](https://github.com/kd2org/opodsync), a gPodder API compatible server previously known as Micro GPodder Server.

The images are based on [FrankenPHP](https://frankenphp.dev/) (and therefore [Caddy](https://caddyserver.com/)) and [Google Distroless Debian](https://github.com/GoogleContainerTools/distroless).


## Installation

```yaml:compose.yaml
services:
  opodsync:
    container_name: opodsync
    image: ghcr.io/tomgehrmann/opodsync:latest
    restart: on-failure:5
    user: ${PUID:-1000}:${PGID:-1000}
    security_opt:
      - "no-new-privileges=true"
      # - "apparmor=docker-opodsync" # optional hardening with AppArmor
    # read_only: true # needs evaluation: can't login if enabled
    mem_limit: 500MB
    cpus: 0.25
    cap_drop:
      - ALL
    ports:
      - "8080:8080"
    volumes:
      - ./data:/var/www/server/data:rw

```

Copy the `config.dist.php` to `./data/config.local.php` on the host.

### Notes

#### Ports

Host port(s) and container port(s) must match the address' port(s) defined in the Caddyfile. You can change the address(es) with the `SERVER_NAME` environment variable.

See [Caddy docs](https://caddyserver.com/docs/caddyfile/concepts#addresses) for further information.

#### Permissions

The user of the application is `nonroot` (`65532`) by default. Mind the file permissions for the mapped directories! Override the user with [`user`](https://docs.docker.com/reference/compose-file/services/#user).

#### TLS Certificates

Caddy supports [HTTPS by default](https://caddyserver.com/docs/automatic-https). As I don't recommend or use this myself, there was only rudimentary testing involved with locally-trusted certificates generated by Caddy. (Use a reverse proxy instead! (If you only access this application through a reverse proxy, only [expose](https://docs.docker.com/reference/compose-file/services/#expose) the ports and use a dedicated Docker network if on the same machine.))

Add the domain to the `SERVER_NAME` environment variable. Don't forget about the [ports](#ports).

#### oPodSync Configuration

To configure oPodSync, edit the config file as described in the [project](https://github.com/kd2org/opodsync?tab=readme-ov-file#configuration).


## Contributions and Maintenance
The builds are fully automated, I use them myself, but I don't actively monitor the health of the service.
Contributions are welcome, but I cannot promise timely replies.
